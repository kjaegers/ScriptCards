ScriptCards Roll20 API Script Changelog

v 2.2.4d - Extended the [F]...[/F] inline formatting code to allow a font to be specified. You can now use [F:fontname:fontsize]...[/F]
           which will create a span (instead of a div) changing the font name and size for that span. Technically the size can be left
           out, but the results may then be browser dependant on what happens when blank font size is used. The [F##]...[/F] structure
           remains unchanged and creats a div with the new font size in the current font.

           Added a new roll formula: XmY, which will roll X dice with Y sides but always return Y as the result. (ie, 4m8 will always
           result in 8,8,8,8 for the dice rolls) Note that this will be flagged in the roll text and hover over indicating that the
           rolls had a minimimum value and what it was (the roll text above would be "8 {MIN:8}, 8 {MIN:8, 8 {Min:8}, 8 {MIN:8}") to
           prevent hiding this type of roll. A message will also be sent to the API Console log listing the player that made the roll
           as well as the roll formula that was used. The intent here is to be able to use something like "[&DamageFormula(replaceall,d,m)]"
           for critical hit rolls for groups using the maximum roll result for criticals without needing to hardcode the critical
           values.

v 2.2.4c - Added the {PAD:X} roll modifier. If added to a roll, the Raw and Total results will be padded with leading zeros to make a value 
           at least X digits long. 
           Ex: --=$Roll|1d100 - 1 {PAD:2} 
           Will ensure that the output will always be a 2-digit number (ie, 03 instead of 3). If the padding length is less than the number
           of digits in the actual number, it will simply be ignored (123 and {PAD:2} will still be 123, and not 12 or 23)
         - Added setting #explodingonesandaces which, if set to 1, will count the 1s and Aces on the rerolled dice in an exploding die roll.
           For example, with this setting off (default) an exploding d6 of 6!6!1 will count as 1 ace and 0 ones. With this setting turned on
           this would count as 2 aces and 1 one.

v 2.2.4b - New dice rolling formula is now available: xUy, which is the same as xDy except that only unique rolls will be returned. In other
           words, if you wanted to roll 8d20, but only get non-repeating values, 8u20 would do so. The values of the dice are stored in a pseudo
           array in the .RolledDice component of the roll variable.

           Ex:

           !script {{
             --=Roll|8u20
             --+Roll|[$Roll]
             --%loop|1;8
               --+Roll [&loop]|[$Roll.RolledDice([&loop])]
             --%|
           }}

v 2.2.4a - Fixes an uncommon sandbox crash bug
           Adds the "fromtable" subcommand for the array function. Will create an array based on the contents of a table. Parameters are the
           name of the array, the name of the table (case sensitive) and what you want back from the table, which can be "name" for the text
           value of each entry, "image" for the image URL, or both for both items separated by a vertical bar.
           Ex: --~|array;fromrollabletable;MyNames;Map-Icons;name
               --~|array;fromrollabletable;MyImages;Map-Icons;image
               --~|array;fromrollabletable;MyIcons;Map-Icons;both
          
           Usage Example:
             !script {{
               --&vbar||
               --~|array;fromrollabletable;MyIcons;Map-Icons;both
               --+Array length|Names [@MyIcons(maxindex)]
               --%loop|foreach;MyIcons
                 --+[&loop(before,[&vbar])]|[r][img][&loop(after,[&vbar])][/img][/r]
               --%|
             }}

v 2.2.4  - Added the --\ command, which logs the content to the API console log. The tag portion of the command is ignored.
         - Started adding code to support event observers - Currently untested
         - It is now possible to compare two empty strings (ie, "" -eq "") and get the proper result. When testing a variable for being empty, always use quotes around it,
             ex: --?"[&Test]" -eq ""|
         - It is now possible to use math functions (ie, {MIN:X}, etc.) inside inline rolls ([=...])
         - Any parameter that sets a color (oddrowbackground, etc.) will now automatically add the # in front if it is passed a 3, 6, or 8 digit hex code string

v 2.2.3  - When creating repeating sections with --!or, ScriptCards will now create the attibutes with empty values first and then set them using ScriptWorkers
           to allow those to trigger properly. A new string variable (SC_LAST_CREATED_ROWID) will be set after using --!or to create a repeating row. This holds
           the internal row ID of the repeating section, so you could access/update the entries after creating by using "repeating_sectionname_[&SC_LAST_CREATED_ROWID]_attrname",
           where sectionname is the repeating section name and attrname is the individual attribute of the repeating row you want to work with.

v 2.2.2  - Corrected unnecessary message in the console log when setting template to "none".

           Added two new string referencing functions : before and after will return the portion of a string variable before or after the specified substring,
           or the entire string if it does not contain the search text.

           !script {{
             --&Line|The Quick Brown Fox Jumps Over the Lazy Dog
             --+Before|[&Line(before,Fox)]
             --+After|[&Line(after,Fox)]
           }}

           Added fromtable as an array creation command: --~tableCount|array;fromtable;MyArray;table-name will create an entry in the MyArray array for each
           entry in the table-name table, and store the number of items returned in a string variable called tableCount.

v 2.2.1  - Loop information is now stashed with saved scripts (as a result of --i or rbuttons), meaning a loop can continue to operate after being interrupted
           by an information request.

           Added "word" as a new expanded string referencing option. Supplying an index number of a word in the string will return just that word. Indexes start
           at 1, and can be negative to return the last word of the string. Index 0 returns the entire string:

           !script {{
             --&Line|The Quick Brown Fox Jumps Over the Lazy Dog
             --+Word 1|[&Line(word,1)]
             --+Word 5|[&Line(Word,5)]
             --+Last word|[&Line(word,-1)]
             --+Fourth from end|[&Line(word, -4)]
           }}

v 2.2.0  - ScriptCards now supports templates that override the visual appearance of an output card. These are based on the Genre Templates in Keithcurtis'
           Supernotes 0.2.0. If you have that mod installed, you will gain access to the 10 templates it contains. ScriptCards itself adds three templates
           to the mix, and you can define your own templates via a mule character.

           Keith's thread: https://app.roll20.net/forum/post/11173104/script-supernotes-0-dot-2-0-now-with-genre-templates/?pageforid=11173104#post-11173104
           Until it comes up on OneClick, you will need to download the temporary git version of the code (linked to near the bottom of the first post in
           that thread) and install it manually. This will give you access to Keith's tmeplates.

           To utilize a template, simply set the --#overridetemplate| option to the desired template (or "none" if you want to specify none, though that is the
           default setting). 
           
           The templates from Keith's mod are: generic, dark, gothic, crt, steam, scroll, apoc, faraway, lcars, notebook.
           ScriptCards defines: dnd5e, dnd1e_green, dnd1e_amber

           Note that using a template really is an override - none of your appearance settings (titlefone, button styles, etc.) will be used when displaying a
           ScriptCard with an override template.

           A template consists of six sections of CSS code (Keith defines two more that aren't used by ScriptCards): boxcode, titlecode, textcode, buttonwrapper, 
           buttonstyle, and footer. Note that in ScriptCards case, the button wrapper is output right before the end of the card, and doesn't actually do anything
           with buttons - it simply allows for the footer to be in the right spot. It should still be included to match the div counts, however.

           If you wish to define your own templates, create a character called "ScriptCards_TemplateMule" (case sensitive) and create an ability with the name
           of your template. The text of the ability MUST be constructed carefully, and I'll include a sample below. Essentially, you need one line for each of the
           six sections, with all "<" and ">" characters replaed with "{" and "}". Note that this means you won't be able to use curly braces inside the template.
           Each line begins with the name of the section (ie, boxcode) followed by two colons (::). Each line ends with two vertical bars (||). Leading spaces in the
           line will be removed automatically, as will line breaks. I suggest working on your styles in something like Notepad++ and pasting them over.

           You can refresh the available templates by running !sc-reloadtemplates from the chat window.

           Here is a simple example: (I'm not saying it *looks* good :))

           boxcode::{div style='background-color: #18769c; box-shadow: 0 0 3px #fff; display: block; text-align: left; font-size: 13px; padding: 5px; 
           margin-bottom: 2px; color: black; font-family: sans-serif; white-space: pre-wrap; line-height:1.3em; font-style:normal'}||
           titlecode::{div style='margin: 0.5em 1em 0.25em 1em; font-size: 16px; font-variant: small-caps; font-family: "Goblin One", sans-serif; color: #000; 
           display: block; margin-block-start: 1em; margin-block-end: 0; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;'}||
           textcode::{/div}{div}{div style='font-weight: normal; display: block; margin: 0 1em 0 1em;'}||
           buttonwrapper::{div style='display:block;'}||
           buttonstyle::style='display:inline-block; font-size: 10px; color:#000; padding: 2px 0px 2px 0px; background-color: transparent; border: 1px solid black; 
           text-align: center; border-radius: 0px;'||
           footer::

           Additional Notes:
           In 2.2.0e, some additional style line options were added. These are slightly different than the Supernotes style lines, but expand on them by allowing
           you to define style information for the subtitle, table components, and the h1..h5 HTML constructs (now parsed from [h1]...[/h1] thru [h5]...[/h5] by
           ScriptCards' inline formatting processor). These style lines are added to a templatemule ability as before except that they should only include the
           options that would go inside a style='...' block and not use single quotes (the are used to wrap the style block). The piece keys for these styles are:
           subtitlestyle, tablestyle, trstyle, thstyle, tdstyle, h1style, h2style, h3style, h4style, and h5style.

           Ex: subtitlestyle::font-size:24pt; font-family:Impact; color:red;

           As part of this change, you can also give a template mule ability the same name as an existing Supernotes/ScriptCards built-in style and override/add
           the pieces you wish based on the style guidelines above.


v 2.1.19 - Object creation now supports the creation of repeating rows via --!or. The syntax is: --!or:character_id:sectionName|value:current:max|value:current:max...
           For example, to create a language proficiency on the currently selected character (5E):

           --!or:@{selected|character_id}:proficiencies|prof_type:LANGUAGE|name:Abyssal
           
           The max portion is optional and can be left out if it doesn't make sense (as in the line above). A bit more complicated example is below. This creates a
           repeating_npcaction on the currently selected character (note that ScriptCards doesn't have a way to check to see if the section exists, it will just create
           the appropriate attributes on the character - again, this is a 5E example, but repeating sections on any sheet can be created as long as you know what
           attributes you need to specify and the name of the section):

           !script {{
             --!or:@{selected|character_id}:npcaction|
                name:Mega Bite|
                attack_flag:on|
                attack_type:melee|
                attack_target:one target|
                attack_range:5 ft.|
                attack_tohit:8|
                attack_damage:1d4 + 3|
                attack_damagetype:piercing|
                attack_tohitrange:+5, Reach 5ft., one target|
                attack_onhit:5 (1d4 + 3) piercing damage|
                attack_crit:1d4
           }}

           Note that this is all one ScriptCards line, and could be written that way. Placing each attribute/value pair on its own line makes it a bit clearer to read, though.

           ScriptCards will assume that the section starts with "repeating_" so it should not be specified in the section parameter (hence "npcaction" instead of "repeating_npcaction")

v 2.1.18 - Bug fix for what I broke in 2.1.17 :)

v 2.1.17 - Added the ability to create abilities with the --! command. The syntax is --!ob:ReturnVarName:CharacterID:AbilityName:IsTokenAction|Text of the Ability
           For example, this will create an abilitiy called "SayHello" on the selected character that runs the Lightning-Bolt ability from the Spell_Mule character.

           !script {{
             --&obrac|{
             --&cbrac|}
             --&perc|%
             --!ob:AbilID:@{selected|character_id}:SayHello:y|[&perc][&obrac]Spell_Mule|Lightning-Bolt[&cbrac]
             --+AbilID|[&AbilID]
           }}

           To break this line (--!ob:AbilID:@{selected|character_id}:SayHello:y|[&perc][&obrac]Spell_Mule|Lightning-Bolt[&cbrac]) down:
             --! is the start of an object moficiation command
             o means create a new object
             b means aBility ("A" would be reserved for attributes)
             AbilID is the string variable that the object id of the new ability will be returned to
             @{selected|character_id} is filled in with the Character ID of the currently selected character
             SayHello is The name of the ability that will be created
             y says that this ability should show up as a token action button when the token is selected
             [&perc][&obrac]Spell_Mule|Lightning-Bolt[&cbrac] is the text of the ability, with variables used on place of %, { and } to avoid having them
               processed by the chat server.

           You could also include references global macros by creating --&hash|# and placing that before the global macro name in the ability text, Ex:
           --!ob:AbilID:@{selected|character_id}:ActionMenu:y|[&hash]ActionMenu

v 2.1.16 - Adds the --w command, which has two related methods of use. --w#| (ie, --w5|) will sleep the sandbox for # seconds (up to 10)
           Note that this has limited usefulness and multiple delays could crash the sandbox by Roll20 thinking it entered an infinite loop.
           The second option is --w#:regularscriptcardsline, for example: --w5:a|CureLightWounds which would run the script normally and
           trigger the system to run the ScriptCard line indicated 5 seconds later. This is done by generating a mini ScriptCard containing
           that single line. Variable referencing is processed when this mini-card is generated. Example:
           
           !script {{ 
             --&SoundToPlay|Spell_FireBurst
             --w3:a|[&SoundToPlay]
             --w4:vtoken|@{selected|token_id} nova-fire
             --w5:!t:@{selected|token_id}|left:250
           }}

           This script will run and output the ScriptCards title. Three seconds later, the Spell_FireBurst audio track will play. One second
           after that, a nova-fire VFX will play at the selected token location, and finally a second after that the token will be moved 
           to x-position 250.

           Note: If the delayed command is a direct output (--+) or GM output (--*) command, the mini-ScriptCard will display the line as
           a new card with the title hidden.

v 2.1.15 - Added the ability to add an additional parameter to array;objects:type;filter to specify a character id for the object
           if it is appropriate. For example, to find all abilities for a given character: 
           --~|array;objects:ability;AbilArray;;@{selected|character_id}

v 2.1.14 - Added "removecustom" as a subfunction for turnorder. Allows for the removal, by custom name, of a custom entry in the
           turn tracker. Ex: --~|turnorder;removecustom;Round Counter

v 2.1.13 - When rolling on rollable tables [T#TableName] if the weights on all of the table entries are 1, the "dice roll" number will
           be saved to the .Total and .Base values for the roll. For any table with at least 1 weight greater than 1, the values will
           both be set to 0 since the roll value would be meaningless as the table gets expanded to account for weights. In addition,
           for all rollable table rolls, the Text and RollText values are now filled in as well, with Text being set to the roll table
           text value from the table (same as tableEntryText).

v 2.1.12 - Revamped the string setting commands (--&, --~|string, --? with a & result, etc.) to allow array element references to be
           set with them, so "--&fruits(1)|watermelon" will set the second element (the indexes start at 0) to "watermelon"). If the
           array does not exist, it will be created. If the element index is greater than the highest index in the array, the element
           will be added to the array. If the index is negative, the element will be added to the beginning of the array. If the index
           exists within the array, the current value for that element will be replaced.

           As indicated above, in addition to the --& command, the following types of commands will also work with this notation:
           
           --~fruits(1)|string;touppercase;grape
           --?1 -eq 1|&fruits(999);mango|&fruits(999);kiwi
           --c[$Result]|1:&fruits(999);apple|2:&fruits(999);banana|3:&fruits(999);watermelon
           
           IMPORTANT NOTE: If you have ScriptCards code that uses numbers in parenthesis after string names (ie, Boom(5), this will be
           a breaking change to that code, though this should be very, very uncommon) 

v 2.1.11 - New String function : stripchars removes all occurrances of any of a given set of 
           characters from a string:
           --~output|string;stripchars;{}";[&MyInputString]
           would remove all {, }, and " characters from MyInputString and store it in output.

         - Added the [*G:...] refence pattern to retrieve game state information. Game state info
           cannot be written (except with the aleady existing functions), but state can be read from
           any API's game state information as long as you know the keys/paths. As an example, if you
           have my EncounterHelper API installed, you can reference the current schema with:
           
           [*G:EncounterHelper:schemaVersion]

           Each component of the state variable tree is separate by colons. If the returned entity is
           an object, it will be stringified before being returned. To get a list of all of the
           state information associated with EncounterHelper, you would use:

           [*G:EncounterHelper]

           Which would return a JSON string representing the stored state data.

v 2.1.10 - Added setting: formatinforequesttext. If set to a non 0 value, will pass the prompt portion of the --i command through the inline formatter.
           Added system;dropoutputlines function. third parameter can be "direct", "gmonly" or "both" and will abandon any --+ and/or --* lines already
           output by the script.
           Bug Fix : Flavor text in roll formula tootips will now display again.

v 2.1.9  - Crash prevention code when rolling on corrupted roll tables that have a blank or non-numeric weight value assigned to an entry.
           Changed the order of setting attributes to use the sheetworker before a direct set.

v 2.1.8  - New looping structures: For...Each, While, and Until. 

           A For...Each loop takes an array a parameter (following the "foreach" identifier) and will iterate over each item in the array. Each 
           time through the loop, the loop control variable will be set to the current item in the array. For the 5E character sheet, the following 
           code would display a list of all of the defined Attacks for a PC:

           !script {{
             --~|array;fromrepeatingsection;Attacks;@{selected|character_id};repeating_attack;atkname
             --%loop|foreach;Attacks
                --+Attack|[&loop]
             --%|
           }}

           Conditional and case statements can use the % and %! branch indicators to continue to the next iteration (%) or exit the loop (%!) as normal.

           ----

           While loops and Until loops function very similarly to each other, and accept a condition after the "while" or "until" keywords. In
           a While loop, the condition is checked before the loop initiates, so it is possible that the loop will not run at all if the condition
           is not true when the loop starts. An Until loop will always run at least once, with the condition being checked at the end. If the
           condition is true as the end of an iteration, the loop will end.

           Both of these loops will generate and display a number that grows until it has 12 digits. 

           !script {{
             --=Iteration|0
             --&MyString|[=1d10 - 1]
             --%loop|while;[&MyString(length)] -lt 12
                --=Iteration|[$Iteration] + 1 
                --+Iteration [$Iteration.Raw]|[&MyString]
                --&MyString|[&MyString][=1d10 - 1]
             --%|
             --+Final|[&MyString], [&MyString(length)]
           }}

           !script {{
             --=Iteration|0
             --&MyString|[=1d10 - 1]
             --%loop|until;[&MyString(length)] -ge 12
                --=Iteration|[$Iteration] + 1 
                --+Iteration [$Iteration.Raw]|[&MyString]
                --&MyString|[&MyString][=1d10 - 1]
             --%|
             --+Final|[&MyString], [&MyString(length)]
           }}

           However, if the initial value of &MyString was, for example, "0123456789012" (13 digits) the while loop would not run at all because 
           the condition is not true when the loop begins. The until loop would run at least once, resulting in a 14 digit number. Note that a
           poorly formed while/until condition can result in an infinite loop, which will cause ScriptCards to reach its statement execution limit
           and abort processing to prevent a sandbox crash. You will get a console log message to that effect if this happens.

           For while and until loops, the % and %! branch indicators in conditional and case statements both exit the loop completely.

v 2.1.7c - When setting attribute values with --!a, the setting will be made normally (with obj.set) and then again with obj.setWithWorker. Note 
           that while this allows sheetworkers to run on the changed value, this happens asynchronously, hence the normal set prior to the worker.

v 2.1.7b - Using object modifiction to set barX_link is now possible, as ScriptCards will locate the attribute ID of the specified attribute on the
           character the token represents and set the link property.

v 2.1.7a - Conditional (--?) and Case (--C) statements now support additional actions for their results. If the first character of a given result
           is a +, a line of output will be generated with the "tag" (bolded) portion of the line separated from the "content" portion by a 
           semicolon. If the first character is a *, a GM-Only output line will be generated following the same format.

           Example:
           !script {{
             --=Roll|1d4
             --+Roll|[$Roll]
             --?[$Roll] -eq 1|*Roll;Was a FUMBLE!|*Roll;Was greater than 1
             --C[$Roll]|1:+Roll;Was a 1!|2:+Roll;Was a 2!|3:+Roll;Was a 3!|4:+Roll;Was a 4!
           }}

v 2.1.7  - Bug fix for setting string values to empty strings as a result of a conditional/case statement.

v 2.1.6  - Additional string variable referencing options are now available. Some options require multiple parmeters, in which case they are
           separated by commas (,). Most of the sequences are case sensitive, though some have "i" variants (icontains, for example) that operate
           in a non-case sensitive mode. NOTE: None of these options modify the value of the string variable - they simply return the result to
           the location in the script where the variable is referenced.

           Examples:
            [&MyString]                      = "The quick Brown Fox jumps over the Lazy Dog"
            [&MyString(length)]              = 43
            [&MyString(tolowercase)]         = "the quick brown fox jumps over the lazy dog"
            [&MyString(touppercase)]         = "THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG"
            [&MyString(totitlecase)]         = "The Quick Brown Fox Jumps Over The Lazy Dog"
            [&MyString(replace,quick,fast)]  = "The fast Brown Fox jumps over the Lazy Dog"
            [&MyString(replaceall,o,i)]      = "The fast Briwn Fix jumps iver the Lazy Dig"
            [&MyString(contains,Dog)]        = 1    <-- Case sensitive contains
            [&MyString(contains,dog)]        = 0    <-- Case sensitive contains
            [&MyString(icontains,dog)]       = 1    <-- Non-Case Sensitive contains
            [&MyString(indexof,Jumps)]       = -1   <-- Case sensitive indexof - indexof returns -1 if not found
            [&MyString(iindexof,jumps)]      = 20   <-- Non-case sensitive indexof. First location where the sequence occurs
            [&MyString(lastindexof,o)]       = 41   <-- The character position (0-based) of the last time the sequence occurs

v 2.1.5  - String variable referencing now supports substring parameters if the variable name is followed by parenthesis. 

           Examples:
             [&MyString]         = "The Quick Brown Fox Jumps Over the Lazy Dog"
             [&MyString(4)]      =      "Quick Brown Fox Jumps Over the Lazy Dog"
             [&MyString(4,5)]    =      "Quick"
             [&MyString(-3)]     =                                          "Dog"
             [&MyString(-8,4)]   =                                     "Lazy"

v 2.1.4  - When using --#whisper| with a non-blank value, the output of the emote area would be skipped. This has been fixed.
           Testing new GitHub integration with Discord channel.

v 2.1.3  - Standardized null/undefined comparisons to avoid potential sandbox crashes in many places across the code.

v 2.1.2  - New array definition functions:
           array;fromrepeatingsection;ArrayName;character_id;repeating_section_name;repeating_field_name
             will return an array by looking up all of the repeating section entries on Character_ID for the "repeating_section_name" repeating list
             and return an array consisting of all of the values of repeating_field_name for that section.
           array;fullrepeatingsection;ArrayName;character_id;repeating_section_name;field1:field2:field3;separation_sequence
             will return an array the same as fromrepeatingsection except that multiple fields can be added to the array entries. The returned values
             will be separated in the array entry by separation_sequence. Note that the field list is colon (:) separated.

v 2.1.1  - The built-in turnorder function now supports sorting the turn order: --~turnorder|sort will sort numerically in descending order. adding
           and optional third parameter with a value of either "a" (for ascending) or "u" (for up) will sort numerically in ascending order.

v 2.1.0  - array;stringify now accepts an optional additional parameter that will be used as the separator when joining the array into a string if
           the parameter is present (Ex. --~Result|array;stringify;MyArray;, will result in a comma separated array instead of the default, which
           is separated by the current value of #parameterdelimiter)

         - array;sort and array;numericsort now accept an optional additional parameter. If this is set to "descending", to sort order will be
           reversed (Ex. --~|array;numericsort;MyArray;Descending)
           
         - It is now possible to set token values to blank with --!t-X statements
         
         - Arrays of object IDs can now be retrieved with array;objects:objecttype;filter. Filter is optional, and will correspond to a field on the
           object to check if the field begins with the filter text. The object types are: campaign, player, page, path, text, graphic, character, 
           attribute, ability, handout, macro, rollabletable, tableitem, deck, card, hand, jukeboxtrack, custfx. The filter fields are "name" if the
           object type has a name property, _displayname for players, title for jukeboxtracks, stroke (color) for paths, text for text and not
           supported for campaign, card, and hand objects. Filters are not case sensitive
             Ex: --~|array;objects:handout;MyArray;magic item
           will return an array with the object IDs of all handouts with a name starting with "magic item"

         - The variable reference notation [*O:objectId:objecttype:property] can be used to retrieve any property from any type of object (with the
           standard limitations on bio, notes, etc.) The object types are: campaign, player, page, path, text, graphic, character, attribute, ability,
           handout, macro, rollabletable, tableitem, deck, card, hand, jukeboxtrack, custfx. Note that you are likely better off using the type-specific
           referencing types when available (like [*C:] for campaign, etc.) Note that retrieving the "action" property of a macros and abilities is not
           supported, as this will often lead to a sandbox crash as ScriptCards tries to parse any potential variables in the macro text.

         - Object modification statements (--!) now support the ability to modify any type of object by specifying the object type and object id in the tag
           portion of the statement. Note that very little checking is done on this (if the property you are setting is imgsrc, the image sorce will be
           reformatted per Roll20 requirements). Ex:

             --!graphic:@{selected|token_id}|bar1_value:256
             
           will set the "bar1_vlaue" property of the selected graphic object to 256. As with variable referencing, you are likely better off using the
           specific object type commands (ie, --!t: and --!a:, etc.) when they are available. Note that setting Bio, Notes, and GMNotes will actually make
           the setting, but it isn't immediate and will not necessarially be available if read back within the same script. It will also throw a console
           message about needing to pass a callback.

         - Some cleanup of undocumented and/or orphaned code

v 2.0.5  - Adds the "<" character as a special signifier in conditional (--?) and case (--c) statements. This will cause a return from a subroutine
           if the execution path of the conditional/case would hit the < character (ie, --?1 -eq 1|<)

v 2.0.4  - Some additional sandbox protection when referencing array elements that don't exist and when using some built in functions without
           appropriate parameters

v 2.0.2k - Bug fix for [*R>...] attribute name lookup when using --Rbyindex to locate repeating rows by index number

v 2.0.2j - [@Array()] or [@Array(length)] now returns the number of items in the array, while [@Array(maxindex)] or [@Array(lastindex)] will return
           the index value of the last item (length - 1)

v 2.0.2i - Bug fix when retrieving repeating section values that are purely numeric (was leaving them out of the returned list)

v 2.0.2h - New string function: striphtml will remove all HTML tags from a string.

v 2.0.2g - Minor bug fixes

v 2.0.2f - The subtitle for the card is now run thorugh processInlineFormatting in order to allow buttons and other formatting in that space.

v 2.0.2e - Added the ability to set currentside of a multisided token and have the image update.
           New inline formatting markup: [F#]...[/F] allows you to set an inline font size equal to # px. Ex: [F10]Size 10p/F]

v 2.0.2d - New setting (buttonpadding) allows you to control the size of the space around the text on buttons. The default padding is "5px"

v 2.0.2c - Created a setting (enableattributesubstitution) to control the attribute lookup code added in 2.0.2b. This behavior is off by default.
           It can be turned on by setting this value to a non-zero value. Fix for a potential sandbox crash if trying to access an array member
           using the [@...()] structure without specifying the () portion. Now, a console log message will state that an invalid array reference
           was attempted.

v 2.0.2b - Code added to resolve nested attribute references. For example, if the "skillbonus" attribute on the character contains "@{pb}", the
           intent is to reference the "pb" attribute on the character. Prior to 2.0.2b, ScriptCards was not parsing these nested references to try to get
           the final value as was simply returning the @{pb} text. This behavior only modifies the *S, *T, *- and *R reference structures since these
           attribute references don't apply to anything that isn't a character.

v 2.0.2a - Adds the --Rbyindex subcommand for retrieving a repeating row from a section by index number as an alternative to --Rfirst/--Rnext and --Rfind.
           The syntax is --Rbyindex|<character_id>;<section_prefix>;<indexNumber> so, for example: --Rbyindex|@{selected|character_id};repeating_attack;3
           to retrieve the third item in the repeating_attack list.

v 2.0.2  - Queued for push to OneClick

v 2.0.1b - Fixes a bug in exploding dice (and anything with a reroll) that could cause REALLY weird results

v 2.0.1  - When using [*id:attribute] referencing it is now possible to use a player ID to retrieve player attribute information.

v 2.0.0  - This version is identical to 1.9.9ce, moving the Triggers and subsequent changes out of the experimental branch and into the primary code base.
           Version 2.0.0 will be headed for OneClick.

v 1.9.9ce- EXPERIMENTAL - Adds the ability to set button font sizes inline with the button declaration. Appending :??px (ie, :24px) to a button Opening
           tag will set the font size for that button : [button:24px] for example. IF you use in-line button colors, they must be specified before
           the font size (so [button:#f00:24px] is fine, but [button:24px:#f00] will not generate a button)

v 1.9.9be- EXPERIMENTAL - New settings: titlefontstyle (default "normal") and titlefontweight (default "strong")

v 1.9.9ae- EXPERIMENTAL - Bug fix for Triggers where no destroy:graphic event was assigned

v 1.9.9e - EXPERIMENTAL - Bug fix for sandbox crash when deleting a graphic if there is no trigger defined for destroy:graphic.

v 1.9.8e - EXPERIMENTAL - Minor bug fixes

v 1.9.7e - EXPERIMENTAL - Added the ability to use the VFX system (--v) to send pings to the VTT. Pings are supported for VFX types of "token" and "point".
           To send a ping, simply replace the effect descriptor with "ping". Optionally, and additional "moveall" parameter can be added to the --v command
           to zoom all players viewes to the pinged location: --vtoken|@{selected|token_id} ping moveall
           
v 1.9.6e - EXPERIMENTAL - Small fix for reroll dice formulas not properly displaying the dice results that were dropped/rerolled in the hoverover.

v 1.9.5e - EXPERIMENTAL - This version of ScriptCards supports triggers, or watching for things to happen in your game and responding to them. 
           In addition to the updated experimental version of the script, I have also included a directory on the github with samples and documentation 
           for the Triggers feature. https://github.com/kjaegers/ScriptCards/tree/main/ScriptExamples/trigger_examples

           This documentation will, in some form, eventually make it to the Wiki if/when Triggers leaves the experimental branch. PLEASE let me know if 
           you run into any issues with Triggers or have questions about how they work. Bonus points if someone catches the old school gaming reference 
           in one of the examples (NOT the "on deck..." reference to critical roll) 

v 1.7.7a - Bug fix for rollable tables broken in 1.7.2

v 1.7.7  - Rolled back the ability to set roll components in a conditional or case statement as there was a bug preventing it from setting roll
           variables at all. Will be corrected in the next version, but is disabled for not.

v 1.7.6  - Added the abilityto set roll components with --= (and case or conditional statements). This is accomplished by including the roll component
           suffix, so --=Roll.Total will allow you to set the Total value on a roll without any relationship to the other components (.Aces, .Odds,
           .Raw, etc.) The most obvious usage of this is to set the .Style component to override fumble/crit/both coloring. There are several script
           settings that control this colorization, so if you want to make a 19 or 20 a crit, you could do the following after the roll:
             --?[$Roll.Base] -ge 19|=Roll.Style;[~stylecrit]
           The defined settings are "stylenone", "stylenormal", "stylefumble", "stylecrit", and "styleboth"
           Note that you are not limited to setting just .Style, but any of the roll components. Use your new powers for good!

v 1.7.5  - Two new settings: outputtagprefix and outputcontentprefix. Anthing in these settings will be pre-pended to the tag or content portion of
           all subsequent --+ or --* lines. By default, outputtagprefix is empty and outputcontentprefix contains a single space. You could use these
           to indent lines by using --#outputtagprefix|&nbsp; or something similar. (&nbsp; is the HTML character for non-breaking space).
           Added some additional information to error messages for conditionals when a value can't be identified.

v 1.7.4  - Reworked the parameters code for Object Modification (--!) to allow for a colon (:) in the content of a setting. Included a function from
           The Aaron's TokenMod to clean up an image url to make it appropriate for setting a token's imgsrc value.

v 1.7.3  - Mostly a code cleanup. Removed some commented out sections and cleaned things up a little.
           Initial card parsing now replaces newlines with spaces to attempt to avoid situations where a line ending with a - is confused for the
           start of a new line (previously newlines were simply removed, so a line ending with a dash could look like --- instead of properly ending
           with a dash and then a new command beginning with two dashes)

v 1.7.2  - Corrected a bug in the display of roll text/details if flavor text was added that began with [T or [t. This was due to the inline
           formatting code thinking the hover-over text was trying to create a table.

v 1.7.1  - New in-line rolling syntax. [...] variable referencing constructs now support = as a type, so [=1d20] will in-line roll 1d20 and replace
           the construct with the raw value of the roll. The roll can also be assigned to a roll variable: [=Result:1d20]. Square brackets are not
           supported in inline rolls, and currently + and - are the only component connectors supported.

v 1.7.0  - Code formatting pass by VS Code
           New expanded suffixes for roll variables: .RollCount, .KeptCount, .DroppedCount, .RolledDice(x), .KeptDice(x), and .DroppedDice(x)

v 1.6.9  - Added object creation to the --! statment with --!o. Currently, character objects can be created using --!oc-ReturnVariableName|CharacterName 

v 1.6.8  - The --i command now uses the value set by #parameterdelimiter

v 1.6.7  - Added the #parameterdelimiter setting to allow you to specify the sequence to be used to separate parameters in most ScriptCards commands.

v 1.6.6  - Bug fix for possible sandbox crash when attempting to retrieve token properties during a variable dereferencing call.

v 1.6.5  - Changed the referencing prefix for settings from # to ~, so [~title] will now refence the card's title setting. # was clashing with formatting.
           New setting: 

v 1.6.4b - The turnorder;addcustom function will now (optionally) accept an additional parameter that will be placed in the "formula" value to create
           custom entries that perform a calculation at the beginning of each round.

v 1.6.4a - Reentrant/resumed cards will now update the SC_SelectedTokens array with the tokens that are selected with the script resumes/reenters.

v 1.6.4  - Added the system string variable 'ScriptCards_Version' (ie, [&ScriptCards_Version]) which will match the current version number. Of course,
           for versions prior to 1.6.4, this will return an empty string.
           Added the pre-defined array SC_SelectedTokens, which will be populated with the token IDs of any tokens selected when the script is run.
           Fixed the turnorder;replacetoken function to properly take the turn order update into account. I had previously only fixed turnorder;addtoken

v 1.6.3  - Bug fix for Deadlands-style rolling (post dice parser rewrite, it was adding all the dice together)

v 1.6.2  - Bug fix for rollable table calls ([T#table-name]) in --= statements not functioning. The modified regex for flavor text, (like [STR]) was
           being checked before the roll table syntax and overriding them.

v 1.6.1  - Removed the lookup in the available token attributes table. All current and future token attributes can now be accessed with the t- syntax.

v 1.6.0  - Added the [#settingname] replacable content reference. This can be used to read back any of the settings supported by ScriptCards. For
           example, [#title] will be replaced with the current value of the "title" setting.
           Added 10 new settings (usersetting0 thru usersetting9). These settings are not used by ScriptCards itself, but they are stored when using
           the --Ssettings command and can be reloaded with --Lsettings and provide user configurable storage that can be stored along with named
           setting sets.
           Minor display tweaks to spacing from the output of the dice roll parser. Added code to accomodate the undocumented Roll20 change to the
           turnorder system. The turnorder functions should once again behave as expected.

v 1.5.8  - Modification to the way repeating attributes are filled in to strip @{ and } from sub references so the actual name of the sub attribute
           is returned, which can then be used within a script.

v 1.5.7  - Minor tweak to the roll parser to allow raw numbers to have a # sign after them (it just gets ignored).

v 1.5.6  - Update to disable recursive deferencing of nested attributes until that code can be rewritten, as it was causing a performance issue when
           dealing with repeating row items.

v 1.5.4  - EXPERIMENTAL - Complete rewrite of the roll parsing system, improving the flexibility of the roll parser and correcting a few bugs. Among 
           the improvements are things like being able to add a # on the end of a dice specifier to prevent highlighting based on that die. For example, 
           if you have a 5E to hit roll of "1d20 + 1d4 [Bless] + 5 [Str] + 2 [Prof]" the old system would highlight the roll as a crit if either the d20 
           was a 20 or the d4 was a 4, and the same for a fumble. Now, appending # to any specifier prevents that roll from contributing to the highlight, 
           so "1d20 + 1d4# [Bless] +5 [Str] + 2 [Prof]" will only highlight the roll based off of the d20 roll and not the d4. This update also removes 
           case sensitivity from roll specifiers, doesn't sort the rolls when using kh or kl modifiers, and marks removed rolls with [x#x] (where # is 
           the number that was on the die that got eliminated), and cuts nearly 240 lines out of the code.

v 1.5.3  - Updated the Wild Die support to color-code based on the Wild Die. Red=1 rolled on first die, Green=Ace rolled on first die, yellow for any other 
           value on the wild die.

v 1.5.2  - Added the --a statement, which will play a jukebox track (specified by the Content of the statement). No external APIs are needed for this
           statement to function. Example:
             --a|SwordHitSound
           Tracks need to exist in your Roll20 jukebox, and the name of the track is case senstivie. If the track does not exist in your game, a warning
           message will be sent to the API console log.

v 1.5.1  - Added support for wild die rolling, signified by a W after the side sides. Optionally, can include "S" to drop an initial 1 on the wild die,
           and/or a "X" to drop the highest die rolled if the Wild die is a 1. For example:
           4d6W - Roll 3d6 and 1d6 as a wild die. If the Wild Die acts as an exploding die, rerolling and increasing the total for every 6 rolled.
           4d6WS - As above, but if the Wild Die's first roll is a 1, it will be treated as a 0.
           4d6WX - As above, but if the Wild Die's first roll is a 1, it will replace the highest die among the 3d6.
           4D6WSX - As above, but if the Wild Die's first roll is a 1, it will be treated as a 0 and the highest die among the 3d6 will be eliminated.

v 1.5.0  - Object modification support is now available in ScriptCards. As of 1.5.0, you can use the --! command to modify object properties in the game. 
           This may help reduce the reliance on the --@ command to run other API commands to modify token/character values. The biggest benefit of this is
           that the changes happen as the script is processing, so the new values are available right away. 
           
           The format of the command is:
           --!<objectType>:<objectId>|setting:value|setting:value|setting:value...
           objectType can be one of "t" for token, "c" for character, or "a" for character attribute
           objectId can be a token id or a character id (or "S"/"T" for the Source/Target token/char defined with --#sourcetoken and --#targettoken)
           settings and value pairs can be chained in a single statement separated by | to impact more than one property/attribute with a single line

           Values can be prefixed with += or -= to add/subtract from the current value (no bounds checking is done). Using [*X] notation, the updated
           values can be read immediately. Using += or -= on non-numeric data will simply result in a string append.

           For "a" types, setting names can be prefixed with a ! to create the attribute if it doesn't exist, and postfixed with ^ to set the max
           value instead of the current value.

           Note that there are VERY few attributes associated with a character object, and there are likely few cases where you would want to set anything
           on the character object, but it *is* still possible.
           
           Examples:
             Set the value of bar1_value for the selected token to 5
             --!t:@{selected|token_id}|bar1_value:5

             Add 1 to the bar3_value for the selected token
             --!t:@{selected|token_id}|bar3_value:+=1

             Set bar2_value to 5 and bar2_max to 10 for the selecte token
             --!t:@{selected|token_id}|bar2_value:5|bar2_max:10

             For the character the selected token represents, set "dndstying" attribute on, set "size" to enormous, and set "attitude" to epic. The 
             attitude attribute will be created if it doesn't exist on the character already. The same is not true for dndstying and size:
             --!a:@{selected|token_id}|dndstyling:on|size:enormous|!attitude:epic

             Adds 50 to the npc_xp attribute for the character represented by the selected token, displaying the value before and after the update:
             !script {{
               --+XP|[*@{selected|token_id}:npc_xp]
               --!a:@{selected|token_id}|npc_xp:+=50
               --+XP|[*@{selected|token_id}:npc_xp]
             }}

v 1.4.12 - Added three new roll modifiers: {MAX:X}, {MIN:X}, and {CLAMP:X:Y}. For MAX, the current value of the roll will be reduced to X if it is
           greater than X. For MIN, the current value of the roll will be increased to X if it is lower than X. CLAMP will ensure that the value is
           between the X and Y value (inclusive). X is the smallest allowed value and Y is the largest.
           Corrected an extraneous debug message displayed when making API calls.

v 1.4.11 - Extended the {ROUND} roll modifier to accept a precision level (ie, {ROUND:2} will round the current value to 2 decimal places). The maximum
           supported precision level is 6.

v 1.4.10 - Added function array;numericsort. Same as the array;sort function, except it sorts numerically instead of alphabetically.

v 1.4.9a - Minor tweak to visual style of hover-over text for Fudge dice.

v 1.4.9  - Added support for Fudge dice rolling (XdF) with values of "-", " ", and "+".

v 1.4.8  - Added the ability to set button colors (text and background) inline using [button:#aabbcc:#ddeeff]. The first set of color codes is the text
           color, and the second is the background color. It is not possible to set the background color without setting the text color. Either three or
           six digits can be used for the color codes. At this time, color names are not supported.

v 1.4.7  - Added XdY!h and XdY!l roll formulas to support Deadlands-style rolls. This notation means roll dY X times, with exploding dice on accessing
           (the max value on the die) and keep either the highest (h) or lowest (l) result.

v 1.4.6  - Corrected sandbox crash introduced in 1.4.5 (findObj vs findObjs)... *sigh*
           Added support for AirBag Crash Handler API Script (if installed)

v 1.4.5  - Added deferral character support for get and set Meta APIs. "get" or "set" followed by the deferral character (default ^) and a . will
           be replaced with "get.", so "get^.mule" becomes "get.mule" when the --@ call is made. Currently multiple deferral characters are not
           supported (ie, get^^.) but I can look to add that support if necessary.

v 1.4.4  - Updated distance calculations to take page scale (snapping_increment) into account
         - Added setting options for rollhilightcolornormal, rollhilightcolorcrit, rollhilightcolorfumble, and rollhilightcolorboth to allow the
           color of the box around rolls to be customized.

v 1.4.3  - Integer (rounded) division was only valid when using constants as the divisior. For other types of divisors the integer division
           operator was being ignored. This has been fixed.
         - Removed some extraneous debug console logging.
         - Added more detail to the missing label error message that gets logged to the console to help identify the problematic line.

v 1.4.2  - Added several additional roll modifiers, including {SIN}, {COS}, {TAN}, {ASIN}, {ACOS}, {ATAN}, {SQUARE}, {CUBEROOT}, {CUBE}
         - Added setting (--#) called "rollhilightlineheight" which can be used to set the size of the roll hilight box. This is useful if you
           have increased the lineheight setting and want the hilight box to expand as well.
         - Fixed the incorrect handling of negative numbers in roll parsing for operations other than addition (which just became subtraction :))

v 1.4.1  - Added math/sqrt function and {SQRT} roll modifier.
         - Fixed abs, min, and max functions that got broken at some point.
         - Fixed a potential sandbox crash if incorrect/missing parameters were passed to replaceVariableContent

v 1.4.0  - (Notes cover 1.4.0 thru 1.4.0e)
         - Switched to all GitHub based distribution - The GISTs will no longer be updated
         - Added code to clean HTML out of button captions to prevent non-working buttons
         - New settings (--#) to support emote fonts: emotefont, emotefontweight, emotefontsize, emotefontcolor
         - Added option parameter to the array/pagetokens function to specify "all", "char", "pc", "npc", or "graphic" to filter returned tokens
         - Added array/sort function
         - Added support for t-lightcolor token attribute
         - Fixed a bug in the Roll Parser that would prevent it from rolling on rollable tables with "-" in the name.
         - Cleaned up spacing in the script (JSherwood)
         - The roll parser now treats numbers in parenthesis as just plain numbers (JSherwood)

v 1.3.9  - (Notes cover 1.3.9 thru 1.3.9c)
         - Added math/angle function to get the angle between two tokens
         - Rewrote the repeating function code to vastly speed up dealing with repeating sections
         - Added array/setatindex function
         - Rewrote [hr] replacement code to be more visually friendly.
         - Added system/findability function to return the object id reference of an ability on a character
         - Added setting (--#) for titlefontshadow

v 1.3.8  - Bug fixes for & variable references and use of non-existant variable names
         - Added system/date/getraw function
         - Added support for settings name aliases for nominmaxhilight/nominmaxhighlight

v 1.3.7  - New Background Image Settings: "bodybackgroundimage", "evenrowbackgroundimage", "oddrowbackgroundimage" and "buttonbackgroundimage". Setting body, even, or odd 
           to anything will result in the colors for those items (both for body, odd for odd, and even for even) being set to #00000000 (transparent) automatically, so if 
           you want some color to overlay the background image, you'll need to set the appropriate color after setting the background image.
         - The buttontextcolor setting can how accept named colors instead of just hex codes.
         - Added system/dumpvariables function for debugging scripts
         - Bug Fix: Corrected a bug that could (in very rare circumstances) cause unexpected behavior when setting the activepage setting.
         - Bug Fix: Tokens that don't represent characters can now have their properties retrieved with t- notation.

v 1.3.6  - (Notes cover 1.3.6 thru 1.3.6b)
         - The buttontextcolor has been modified to accept either hex color codes or named colors.
         - Tweaked regex expression for variable substitution that supports extended characters (accented, etc.)
         - If you save a card setting list (with --ssettings) and name it "Default" (case sensitive) it will be loaded at the start of every script. You can always load 
           another set (which will be merged with Default) or remove the "Default" set to alter this behavior.
         - Bug Fix: The nominmaxhighlight "fix" from 1.3.5 broke roll highlighting completely. It is repaired now.
         - New Setting: norollhighlight. If set to a value other than the default ("0"), will not place any highlight box around rolls generated while the setting is active. 
           This will still add a tooltop, and can be used when you wish to pass the roll to something else without the yellow/green/blue/red box around the roll.
         - New Setting: titlecardbackgroundimage. Default is empty. If set, the value will be applied to the css "background-image" tag for the title card. This should be a 
           full CSS specifier, like "url(https://mywebsite.domain/path/to/image.png)".
         - New Setting: titlecardgradient. If not "0", will apply a gradient overlay to the title card background color. Default is no gradient. NOTE: This setting actually 
           overrides the titlecardbackground setting, and the two cannot be used together. You can either have a gradient or have a background image.

v 1.3.5  - Bug Fix: Restored functionality to the "nominmaxhilight" setting.
         - New readsetting sub-function: This function is part of the "system" function group, and allows you to retrieve the current value of a ScriptCards setting as a string
         - New findtoken Sub-function: Added the "findtoken" subfunction to turn order, which will return the initiative tracker value of the indicated token
         - New Settings: Added two new settings (locale and timezone) to support the date functions below.
         - New system/date functions: Added the "date" sub-function category with three options: "getdatetime", "getdate" and "gettime". These functions utilize the "timezone" 
           and "locale" settings to return localized time. Note that the locale setting currently has no effect, as this does not appear to be active/enabled in the Roll20 
           javascript engine - but timezone does work properly.

v 1.3.1  - Behavior Change: Rewrote all content substitution code as a single function that works from the innermost set of references outward, so something like  &wow[$count[&suffix]]] 
           will process [&suffix] first, then [$countX] where X is the result of [&suffix] and finally [&wow1] where 1 is the result of [$countX]. This makes the language more logical 
           and variable resolution more deterministic. It is also a huge performance improvement, since the way variables were replaced previously was highly non-optimal. NOTE: as a 
           side effect of this change, some of the uncommonly used settings (disablerollvariableexpansion and similar) will not function at this time. They were primarily for debugging 
           purposes and will return in a future update, but won't have an effect at this time.
         - Array Referencing: It is now possible to reference array items directly with the [@arrayName(index)] syntax. The first element of the array is index 0, etc.
         - Additional Roll Variable Suffix: You can now use ".Raw" suffix when referencing a roll variable to skip formatting the result as a roll. This shouldn't normally be necessary, 
           as roll formatting is only done on --+ and --* lines, but it is available, especially given the special note in the previous item.
         - Behavior Change: When generating tooltips (and only when generating tooltips) for roll variable display, the "~" character will be removed. This makes it easier to hide 
           what look like rolls from the chat server when referencing nested values (ie, [~[&shortSaveNameUpper]~]) when you just want the value of the variable in square brackets as 
           an explanation, since using [[&shortSaveNameUpper]] would look like an inline roll to the chat server.
         - Feature Update: Added support for new token properties added to Roll20 on 2021-06-03 (bar_location, compact_bar, light_sensitivity_multiplier, and night_vision_effect). 
           As with all token references, these are made with the "t-" prefix.

v 1.2.9  - Bug Fix - The "after" string function will now omit the specified separator from the value it returns.
         - Formatting - No functional change, but apparently at some point I hilighted the whole script in VSCode and hit tab a couple of times and indented everything. I fixed that :) 
           I've also begin adding more verbose comments throughout the code. That will continue as a work in progress.
         - Custom VFX for Point effects - The relatively new "--Vpoint" effect statement now supports custom FX.
         - New Distance Functions - Two new distance functions are available. "euclideanpixel" will return the raw pixel distance between two tokens (without dividing by 70). "euclideanlong"
           will return the unit distance, but divides the result by 70 AFTER calculating the distance to reduce rounding errors over very long ranges.
         - New String Functions - "replaceall" will replace all occurrences of the search string in the source text (replace replaces only the first occurrence). "trim" will remove spaces 
           from the beginning and end of the string.
         - Behavior Change - I have added a new setting value called "executionlimit", with a default of 30000. When processing a script, the number of lines executed is tracked. If that 
           number exceeds "executionlimit", ScriptCards will log an error message to the API console and abort execution of the script. If you need to execute more than 30000 lines of code, 
           just set the parameter higher for that particular script (i.e. : --#executionlimit|100000). The intent here is to prevent scripting logic errors from crashing the sandbox with an 
           infinite loop. My lightningbolt and fireball macros in VERY crowded areas don't hit the 30000 limit, so it should be good for most scripts. I can always up the default if there 
           are issues.
         - Deferred Meta Script Resolution - I mentioned this in 1.2.8a, but I've expanded on it a bit. As some more detail, when calling another API script with ScriptCards via 
           the --@ statement, it is now possible to include some meta script (SelectManager, Fetch) by inserting a deferral character into the meta call. 

v 1.2.8  - Added beginnings of deferral character support for including references to meta scripts inside a scriptcard.
         - New String Functions: replaceall and trim. replaceall works just like replace except it will replace all occurrences of the search string. Trim will remove spaces from the 
           beginning and end of the string.
         - New VFX Option: You can now spawn visual effects and arbitrary points with the --Vpoint| command. The parameters (separated by spaces) are X Y shape-color, and are measured in pixels. 
           If #activepage is set, the VFX will play on that page. Otherwise it will default to the player ribbon page. 
         - New Roll Parser Functions: As you may know, the ScriptCards roll parser works from left to right, always maintaining a current value and applying whatever comes next to the total. 
           This has allowed me to add some in-line functions to the roll parser. These are {ABS} - Absolute value, {CEIL} - Ceiling value (round up to the next whole number) {FLOOR} - Floor value 
           (round down to the next whole number), {ROUND} - Round value (round up if the decimal portion is greater than 0.5, otherwise round down), {NEGATE} - Multiply the value by negative one.

v 1.2.7  - Bug Fix: Corrected a bug introduced in 1.2.3 that would return "undefined" for token/character references ([*x:] syntax) that were 0 or null. (Thanks Will M.)
         - Data Statements: Support for BASIC-style read/data statements with the --d statement has been added. Data can be defined anywhere in your script with the --d!|element1;element2;element3;etc... 
           statement. Data is pre-processed into a structure that can be read with the --dVarName| command to read the next available data element into a string variable called "VarName". When attempting 
           to read past the last available element, a value of "EndOfDataError" will be returned. You can reset the data pointer to begin reading again from the beginning with --d<|. 
         - For...Next Loops: It is now possible to create For...Next loops in ScriptCards with the --% statement type. A loop is defined by starting off with --%LoopCounter|<start>;<end>;[step]
           The <start> and <end> values are required, while the [step] parameter is optional. If the step is omitted, it will be assumed to be 1. A string variable (in this case called "LoopCounter")
           will be created and will hold the current iteration value for the loop. The end of the loop is signified by --%|, which will increment the counter and check to see if the end point has been
           passed. If not, execution will return to the statement after the initial --% statement. Loops CAN be nested within each other, and the step value can be negative if you wish to run a loop 
           downwards. A conditional can end the current iteration of a loop with the % character, or break out of the loop entirely with %!. Finally, modifying the LoopCounter variable will not have any 
           impact on the loop or the number of iterations it runs. When execution returns to the top of the loop, the value of the variable will be reset to the current loop counter, which is 
           tracked internally.
         - Conditional Code Blocks: Added the ability to define blocks of code in association with conditional statements. This is similar to begin...end or curly braces in some languages, though a bit 
           more limited. As part of the true or false execution branch of a conditional, you can use the "[" character to begin a code block. If that execution path is taken, the code in the block will be 
           executed. Otherwise, the code in the block will be skipped. Blocks are completed with the --]| statement, and can optionally include an "else" block by using --]|[ as the block terminator. 
           At this time, blocks cannot be nested, and can only be created as part of a conditional (--[ is not a valid statement type)

v 1.2.3  - It is now possible to retrieve object properties from characters (as opposed to just attributes). Things like "controlledby" are now available. Unfortunately, notes, gmnotes, and bio are not
           available because of the way they have to be retrieved by the API.
         - Tag portions of a line are now trimmed, meaning trailing spaces should no longer cause them to be included at the end of variable names. Spaces inside variable names should still be fine. 
           Trimming was already happening on the content side of a statement.
         - ScriptCards will now replace inline rolls with their total results, so it should be possible to use a syntax like:
                  --=AC|[[ @{selected|armorclass} ]]
                  --+AC|[$AC]
           but note that ONLY the total result will be used by ScriptCards. It will not break the roll down into components like to normal roll parser does. This does allow quite a bit more flexibility
           for totally insane sheet calculations, however :) I still recommend using the internal roll parser for most things, but at least this will let you set variables for things like 3.5 AC.
         - New Functions: Added three new string functions: tolowercase, touppercase, and totitlecase. Each just takes the string to process as the only additional parameter and returns the result 
           to the string variable named in the tag portion of the statement. "tolowercase" and "touppercase" are fairly obvious. "totitlecase" capitalizes the first letter of each word in the string 
           (note that it doesn't account for things like not capitalizing "a" or "of", etc.)
         - Behavior Change: setting the sourcetoken or targettoken to a non-existent token or something that doesn't represent a character will now clear the internal cached character object as well. 
           This would be useful it you wanted to set a source/target for use with [*S:] or [*T:] notation but didn't want to display tokens in the emote section. Simply setting them to nothing 
           (--#sourcetoken|) before the end of the script will remove the references.

v 1.2.2  - Passing empty parameters should once again be supported.
         - You can also use either single or double quotes around parameters that contain a semicolon (I found some regex to parse CSV files and just changed the comma to a semicolon). 
         - You can now set an active page with the --#activepage|pageid setting. If you use "playerpage" as the page id, the current ribbon page will be used (so, --#activepage|playerpage) 
           or (see next item) --#activepage|[*C:playerpageid]
         - There are two new [*X:] attribute accessing options : [*C:attribute] will retrieve campaign-level attributes. Probably the only really useful one is "playerpageid", but they are all 
           available. [*P:attribute] will retrieve attributes on the activepage (which must be set beforehand). All of the UDL items should be available here, though I don't use UDL so I'm not 
           familiar with them.
         - Retrieving token GMNotes will (with something like [*T:t-gmnotes], or [*-sometokenid:t-gmnotes] will now run the result through decodeURIcomponent to get rid of the URI encoding as 
           return the notes as expected. Formatting like bold and italics, etc. should still work. 